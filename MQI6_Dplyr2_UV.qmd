---
title: "Dplyr II"
subtitle: "Metodologia Quantitativa I (UPF)"
author: "Jordi Mas Elias"
institute: "<https://www.jordimas.cat/>"
footer: "Metodologia Quantitativa I (UPF)"
logo: logo-upf.png
format: 
  revealjs:
    embed-resources: true
    slide-number: true
    show-slide-number: print
    theme: simple
editor: source
editor_options: 
  chunk_output_type: console
---

## Sumari

- Resumir variables categòriques
- Resumir variables numèriques
- Resumir per grups

# Warm up {background-color="#e8e8e8"}

## R learning curve

```{r}
library(dplyr)
library(ggplot2)
festivals <- readRDS("data/festivals.rds")
lloguer_any <- readRDS("data/lloguer_any.rds")
cens_gc <- readRDS("data/cens_gc.rds")
municipi <- readRDS("data/municipi.rds")
rlc <- tibble(class = 1:8,
             knowledge = (1:8)^3)
class <- 5
plot(rlc$class, rlc$knowledge)
points(rlc$class[class], rlc$knowledge[class], col = "red")
theme_set(theme_minimal())
```

## RStudio workflow

**Load packages.**

```{r echo = T, message=F, warning=F}
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
```

![](img/r-packages.png){style="float:center;" width="650"}




# Resumir variables categòriques {background-color="#e8e8e8"}

## Variables categòriques

```{r echo = T, eval = T}
festivals$ambit
```


## Variables categòriques {.scrollable}

Quantificar (buscarem la **Moda**, el valor més repetit):

- Count: `count(d, v, sort = T)` 

```{r echo = T, eval = T}
count(festivals, ambit, sort = T)
```

- Taula de freqüències: `table(df$v)`

```{r echo = T, eval = T}
table(festivals$ambit)
```

- TF en percentages: `prop.table(table(df$v)) * 100`

```{r echo = T, eval = T}
prop.table(table(festivals$ambit)) * 100
```

## Variables categòriques {.scrollable}

Visualitzar.

- Diagrama de barres: `barplot(table(df$v))`

```{r echo = T, eval = T}
barplot(table(festivals$ambit))
```

- En %: `barplot(prop.table(table(df$v)))`

```{r echo = T, eval = T}
barplot(prop.table(table(festivals$ambit)))
```


```{r eval = F}
table(festivals$ambit)
barplot(table(festivals$ambit))
count(cens_gc, indret_desaparicio)
```


# Resumir variables numèriques {background-color="#e8e8e8"}

## Variables numèriques

Quantificar: On es troba el **centre**?

```{r echo = T, eval = T}
lloguer_any$preu
```



## Variables numèriques

Quantificar: On es troba el **centre**? `median()`, `mean()`.

![](img/uni-mean-median.png)

## Variables numèriques

Quantificar: On es troba el **centre**?

[![](img/gdp-median-nyt.png)](https://www.nytimes.com/2014/09/17/upshot/you-cant-feed-a-family-with-gdp.html)

## Variables numèriques

Quantificar: On es troba el **centre**?

![](img/uni-mean-extreme.png)


## Variables numèriques


Quantificar: Mesures de **dispersió**.

:::: {.columns}

::: {.column width="60%"}

- Min: `min()`
- Max: `max()`
- Rang: `diff(range())`
- Quantils: `quantile()`
- Rang InterQuartilic: `IQR()`
:::

::: {.column width="35%"}
![](img/uni-dispersion-range.png)
:::

::::


## Variables numèriques

Quantificar: Mesures de **dispersió**.

- **Desviació estàndard:** Com de lluny respecte la mitjana? `sd()`

![](img/uni-dispersion-sd.png)


## Variables numèriques {.scrollable}

Les funcions, aplicades.

Mitjana: `mean()`

```{r echo = T, eval = T}
mean(cens_gc$periode_desaparicio_1, na.rm = T)
```

Mediana: `median()`

```{r echo = T, eval = T}
median(cens_gc$periode_desaparicio_1, na.rm = T)
```



Min: `min()`

```{r echo = T, eval = T}
min(cens_gc$periode_desaparicio_1, na.rm = T)
```

Max: `max()`

```{r echo = T, eval = T}
max(cens_gc$periode_desaparicio_1, na.rm = T)
```

Rang: `diff(range())`

```{r echo = T, eval = T}
diff(range(cens_gc$periode_desaparicio_1, na.rm = T))
```

Quantils: `quantile()`

```{r echo = T, eval = T}
quantile(cens_gc$periode_desaparicio_1, 0.25, na.rm = T)
quantile(cens_gc$periode_desaparicio_1, 0.75, na.rm = T)
```

Rang Interquartílic: `IQR()`

```{r echo = T, eval = T}
IQR(cens_gc$periode_desaparicio_1, na.rm = T)
```

Desviació típica: `sd()`

```{r echo = T, eval = T}
sd(cens_gc$periode_desaparicio_1, na.rm = T)
```







## Variables numèriques

Visualitzar: "Valor" més repetit (Moda) `hist(df$v)`.

::: {.panel-tabset}

## As. negativa
```{r}
municipi |> 
  ggplot(aes(x = altitud_m)) +
  geom_histogram() +
  geom_vline(xintercept = mean(municipi$altitud_m), col = "blue") +
  geom_vline(xintercept = median(municipi$altitud_m), col = "green")
```

## Normal
```{r}
lloguer_any |> 
  ggplot(aes(x = preu_m2)) +
  geom_histogram() +
  geom_vline(xintercept = mean(lloguer_any$preu_m2, na.rm = T), col = "blue") +
  geom_vline(xintercept = median(lloguer_any$preu_m2, na.rm = T), col = "green")
```


## As. positiva

```{r}
c <- tibble(d = c(rnorm(1:5, 35, 20), rnorm(1:50, 50, 15), rnorm(1:70, 70, 2)))
c |> 
  ggplot(aes(x = d)) +
  geom_histogram(bins = 10) +
  geom_vline(xintercept = mean(c$d, na.rm = T), col = "blue") +
  geom_vline(xintercept = median(c$d, na.rm = T), col = "green")
```

## Bimodal

```{r}
r <- tibble(g = c(rnorm(1:100, 30, 10), rnorm(1:100, 70, 10)))

r |> 
  ggplot(aes(x = g)) +
  geom_histogram(bins = 10) +
  geom_vline(xintercept = mean(r$g, na.rm = T), col = "blue") +
  geom_vline(xintercept = median(r$g, na.rm = T), col = "green")
```

:::

## Variables numèriques

Visualitzar: Notes finals curs 2023

![](img/notesfinals23.png)






# Summarize i group_by functions {background-color="#e8e8e8"}

## Funció summarize

- Resumeix les dades.

```{r echo = T, eval = F}
df |> 
  summarize(name = sum(vector))
```

- Es poden resumir varis elements:

```{r echo = T, eval = F}
df |> 
  summarize(name1 = sum(vector_a),
            name2 = mean(vector_z),
            n = n())
```

*Posar sempre l'argument `na.rm = T`.


## Group_by   

- Sempre es combina amb una altra funció (e.g. `summarize`, `filter`, `mutate`), agrupa les dades pels valors d'un vector^[Aquest vector és normalment un vector de caràcter o un factor, però pot ser també un altre vector amb poques categories (discret).]...

```{r echo = T, eval = F}
df |> 
  group_by(vector) |> 
  summarize(name1 = sum(vector))
```

*Important!!! Amb group_by i summarize, canviem la __unitat d'observació__ del dataset.


# Consells i trucs {background-color="#e8e8e8"}

## Consells i trucs

- Fer pregunta i respondre.
- Il·luminar el codi, pas a pas.
- Acabar amb `glimpse()` o `View()`.
- Acabar amb `pull() |> unique()`.
- [Cheat sheets](https://posit.co/resources/cheatsheets/){target="_blank"}




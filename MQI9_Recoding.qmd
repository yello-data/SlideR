---
title: "Recodificar variables"
subtitle: "Metodologia Quantitativa (UPF)"
author: "Jordi Mas Elias"
institute: "<https://www.jordimas.cat/>"
footer: "Metodologia Quantitativa (UPF)"
logo: logo-upf.png
format: 
  revealjs:
    embed-resources: true
    slide-number: true
    show-slide-number: print
    theme: simple
editor: source
editor_options: 
  chunk_output_type: console
---

  
## Sumari
  
- Operadors booleans
- Relabel functions
- Funció factor
- Funcions as.xxxx

# Warm up {background-color="#e8e8e8"}

## Corba d'aprenentatge d'R

```{r}
library(dplyr)
library(ggplot2)
festivals <- readRDS("data/festivals.rds")
lloguer_any <- readRDS("data/lloguer_any.rds")
cens_gc <- readRDS("data/cens_gc.rds")
municipi <- readRDS("data/municipi.rds")
rlc <- tibble(class = 1:8,
              knowledge = (1:8)^3)
lesson <- 8
rlc |> 
  ggplot(aes(x = class, y = knowledge)) +
  geom_line(size = 1) +
  geom_point(data = rlc |> 
               filter(class == lesson), col = "red") +
  annotate("text", x = 4.5, y = 375, label = "You are here!") +
  geom_curve(aes(x = 5, xend = 7.8, y = 400, yend = 515),
             arrow = arrow(length = unit(0.08, "inch")), size = 0.5,
             color = "gray40", curvature = -0.3) +
  theme_minimal() +
  labs(x = "Class number", y = "Knowledge", title = "The R Knowledge curve")
```


## RStudio workflow
  
**Carreguem paquets**
  
```{r echo = T, message=F, warning=F}
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(forcats)
library(readxl)
library(vdemdata)
```

![](img/r-packages.png){style="float:center;" width="650"}




# Funcions i operadors {background-color="#e8e8e8"}


## Operadors booleans

- **AND** (`&`): TRUE si totes les condicions estan satisfetes.
- **OR** (`|`): TRUE si alguna condició està satisfeta.
- **NOT** (`!`): TRUE si la condició no està satisfeta.

```{r echo = FALSE}
#| fig-column: margin
knitr::include_graphics("img/booleans.png")
```


## Recoding functions

Quan recodifiquem variables, perdem informació^[Busca aquí pel [dplyr cheatsheet](https://posit.co/resources/cheatsheets/){target="_blank"}.].

| A           | Funció                                              |
|-------------|-----------------------------------------------------|
| Binària     | `if_else()`                                         |
| Categòrica  | `case_when()`, `case_match()`                       |
| Ordinal     | `factor()`                                          |
| Altres      | `as.numeric()`, `as.character()`, `as.Date()`, etc. |
  
  
# Reetiquetar {background-color="#e8e8e8"}
  
  
## If_else
  
- A variable dicotòmica / binària / dummy.

```{r echo = T, eval = F}
df |> 
  mutate(new_name = if_else(logic operation, true, false))
```




## Case_when

```{r echo = T, eval = F}
df |> 
  mutate(new_var = case_when(logic operation ~ "C1",
                             logic operation ~ "C2",
                             logic operation ~ "C3",
                             ...,
                             .default ~ "CN"))
```



## Case_match

```{r echo = T, eval = F}
df |> 
  mutate(new_var = case_match(variable,
                              "c1" ~ "C1",
                              "c2" ~ "C2",
                              "c3" ~ "C3",
                              ...,
                              .default = "CN"))
```



## Factor

```{r echo = T, eval = F}
df |> 
  mutate(new_vector = factor(wb$income_group, 
                             ordered = TRUE,
                             [levels o labels = ...]))
```


## Funcions as.xxxxx

- `as.numeric(vector)`
- `as.factor(vector)`
- `as.character(vector)`
- `as.integer(vector)`
- `as.Date(vector)`




---
title: "RMarkdown"
subtitle: "Postgrau d'Analista de Dades (UB)"
author: "Jordi Mas Elias"
institute: "<https://www.jordimas.cat/>"
footer: "RMarkdown - Postgrau d'Analista de Dades (UB)"
logo: ub-logo.png
format: 
  revealjs:
    slide-number: true
    show-slide-number: print
    theme: simple
editor: visual
---

## Sumari

```{r}
library(tidyverse)
```

1.  Què és RMarkdown?
2.  Repàs R
3.  etc.

# Què és RMarkdown? {background-color="#e8e8e8"}

## Un paquet d'R

S'instal·la com qualsevol altre.

![](img/rmd-package.png){style="float:right;" fig-alt="RMarkdown logo." width="300"}

```{r echo = T, eval = F}
install.packages(c("rmarkdown",
                   "knitr", 
                   "DT"))
```

![](img/r-packages.png){style="float:center;" width="650"}

## Un llenguatge (o una prosa) {.scrollable}

![](img/gruber.png){style="float:right;" fig-alt="Illustration of three species of Palmer Archipelago penguins: Chinstrap, Gentoo, and Adelie. Artwork by @allison_horst." width="300"}

::: columns
::: {.column width="50%"}
-   John **Gruber**, 2004.
-   Un format més **fàcil de llegir** i d'escriure que la majoria de llenguatges web com l'Html.
-   **Convertible** fàcilment a Html, Pdf...
:::

::: {.column width="40%"}
:::

```{r eval = T, fig.align='center', fig.width=20}
knitr::include_graphics("img/html-code.png")
```
:::

## Eina per a presentar resultats {.scrollable}

::: columns
::: {.column width="50%"}
-   Imprescindible per a un bon analista de dades.
-   Permet transformar en un ampli rang de formats el codi d'R.
-   Exemples:
:::

::: {.column width="40%"}
```{r eval = T, fig.align='center', fig.width=20}
knitr::include_graphics("img/rmd-formats.png")
```
:::
:::

::: aside
-   [https://rmarkdown.rstudio.com/gallery.html](https://rmarkdown.rstudio.com/gallery.html){target="_blank"}
-   [https://quarto.org/docs/gallery/](https://quarto.org/docs/gallery/){target="_blank"}
-   [https://www.jordimas.cat/](https://www.jordimas.cat/){target="_blank"}
:::

# Repàs primeres sessions {background-color="#e8e8e8"}

## RStudio

::: incremental
-   Crear projecte\
-   Diferència entre instal·lar i carregar paquets
-   Utilitzar l'Environment
-   Importar arxius: csv, csv2, xlsx, dta, sav...
:::

## RMarkdown

Crear un document: YAML - Text - Chunk

![](img/rmd.png){style="float:left;" fig-alt="RMarkdown logo." width="290"}

## Descarregar tutorial

<https://www.jordimas.cat/files/Tutorial_Rmd_Polity.zip>

![](img/polity-map.png)

# Tutorial RMarkdown {background-color="#e8e8e8"}

## Exercici 1

Crear una petita història amb **Polity V**:

-   Descarregar la base de dades Polity V a <https://www.systemicpeace.org/inscrdata.html>
-   Text amb tots els formats possibles.
-   Un marc de dades
-   Dos plots

## Slide with a pause

content before the pause

. . .

content after the pause

## Slide Title {.smaller}

Holi holi

## Slide Title {.scrollable}

## Footers

-   Green [^1]
-   Brown
-   Purple

[^1]: A footnote

::: aside
Some additional commentary of more peripheral interest.
:::

::: footer
Custom footer text
:::

## Code

``` {.r code-line-numbers="2-3"}
install.packages(c("rmarkdown",
                   "knitr", 
                   "DT"))
```

Holi

``` {.r code-line-numbers="2,4"}
install.packages(c("rmarkdown",
                   "dplyr",
                   "ggplot2",
                   "knitr", 
                   "DT"))
```

Holi

``` {.r code-line-numbers="|2|4"}
install.packages(c("rmarkdown",
                   "dplyr",
                   "ggplot2",
                   "knitr", 
                   "DT"))
```

## Executable code

```{r echo = TRUE}
#| code-line-numbers: "|2|4"
starwars |> 
  select(name:last_col()) |> 
  filter(hair_color == "blond") |> 
  arrange(height)
```


# RMarkdown avançat (YAML) {background-color="#e8e8e8"}

## Data automàtica

Quan fem **Knit**, ens imprimeix automàticament el dia d'avui.

```{r eval = F, echo = T}
date: "`r Sys.Date()`"
```

```{r eval = T, echo = F}
Sys.Date()
```

. . .

```{r eval = F, echo = T}
date: "`r format(Sys.time(), ‘%d %B %Y’)`"
```

```{r eval = T, echo = F}
format(Sys.time(), '%d %B %Y')
```

. . .

```{r eval = F, echo = T}
date: "Última edició `r format(Sys.Time(), '%d %B %Y')`"
```

```{r eval = T, echo = F}
paste0("Última edició ", format(Sys.time(), '%d %B %Y'))
```

## Foto

Posem una foto a la capçalera del document.

```{r eval = F, echo = T}
title: "![Posar nom de títol](img/polity-index.jpeg){width=2}"
```

![](img/polity-index.jpeg){width="2"}

## Taula de continguts

Customitzem elements de la taula de continguts.

``` {.r code-line-numbers="1-4"}
toc: true
toc_depth: 2
number_sections: true
toc_float:
  collapsed: false
  smooth_scroll: false
```

::: aside
-   `toc:` volem taula de continguts?
-   `toc_depth:` de quina profunditat?
-   `number_sections:` les seccions han d'anar enumerades?
-   `toc_float:` la taula de continguts ha de ser flotant?
    -   `collapsed:` s'amaga automàticament?
    -   `smooth_scroll:` navegació suau.
:::

## Tema

Seleccionem l'estil visual i el subratllat:

-   **Tema:** default, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, yeti, null.

```{r eval = F, echo = T}
theme: paper
```

-   **Highlight:** default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark, textmate, null.

```{r eval = F, echo = T}
highlight: tango
```

::: aside
Per una llista dels diferents estils de temes i subratllats veure [aquest enllaç](https://bookdown.org/yihui/rmarkdown/html-document.html#appearance-and-style) i per una llista amb contingut més avançat veure [aquesta llista](https://www.datadreaming.org/post/r-markdown-theme-gallery/).
:::

## Gràfics per defecte

Els gràfics que apareixen al document han de tenir per defecte algunes dimensions determinades?

```{r eval = F, echo = T}
fig_width: 6 
fig_height: 4 
```



## Paràmetres {.scrollable}

Establim uns paràmetres^[Molt útil per fer [RMarkdowns interactius](https://bookdown.org/yihui/rmarkdown/params-knit.html#params-knit) per establir els paràmetres de base.] al YAML que al llarg del document podrem utilitzar com a codi.

```{r echo = T, eval = F}
params:
  country: "Denmark"
  year: 2014
```

En el document, podem accedir als paràmetres de tres maneres:

- A. Al text,  

```{r echo = T, eval = F}
`r params$country`
```

- B. Als chunks, 

```{r echo = T, eval = F}
filter(dataset, country == params$country)
```

- C. Als títols de gràfic, 

```{r echo = T, eval = F}
"blablabla `r params$country`"
```

## Plegar codi

Creem un desplegable per cada chunk amb codi `(echo = T)` que tinguem al document.

``` {.r code-line-numbers="4"}
title: "Postgrau d'Analista de Dades (UB)"
output:
  html_document:
    code_folding: hide
```

## Formats d'output

Al YAML podem especificar el tipus de format.

``` {.r code-line-numbers="4,6,8"}
title: "Postgrau d'Analista de Dades (UB)"
author: "Nom de l'estudiant"
output:
  html_document:
    code_folding: hide
  pdf_document:
    toc: yes
  word_document:
```

I també podem crear [diapositives](https://quarto.org/docs/presentations/revealjs/)

# Text avançat {background-color="#e8e8e8"}

## Tabsets

::: panel-tabset
### Codi

```{r echo = T, eval=F}
::: panel-tabset
### Tab A

Contingut de `Tab A`

### Tab B

Contingut de `Tab B`
:::
```

### Gràfic

```{r echo = F}
hist(dplyr::starwars$height)
```

:::


## Incloure codi al text

En qualsevol moment podem fer referència al text sobre qualsevol dada **ja carregada** en un chunk previ.

- A. Carreguem les dades:

```{r echo = T, eval = F}
polity <- read_excel("p5v2018.xlsx")
```

B. Referenciem les dades al text de la següent manera:

```{r echo = T, eval = F}
`r polity$country[1]`
```



## Quadres de text

```{r echo = T, eval = F}
</div>
```

## Incrustar tuits i vídeos



## Referències al text

Per referenciar una secció del document, el més adequat és posar el codi de la referència just després del títol de secció. Aquest codi el posarem entre claus i encaplaçat del coixinet. Per exemple:

    # Introducció{#intro}

Llavors, en qualsevol moment del text podrem referenciar la secció d'una manera molt similar a la manera que referenciem les pàgines web: `[text](#intro)`. El text que faci la referència el posarem entre claudàtors seguit dels parèntesis, que inclouran el codi de la secció amb un coixinet davant.


En aquest [enllaç](https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html){target="_blank"}, també podeu veure com es poden referenciar taules i marcs de dades.

## Posar bibliografia {.scrollable}

Amb un document **BibTex** (`.bib`)^[Alguns paquets d'R com `RefManageR` automatitzen la gestió de cites.]. 

1. Obrim un document de text (**Text file**) i el guardem com a `biblio.bib`.

<!-- -->

    @book{Singer1972,
    address = {New York},
    author = {Singer, J. David and Small, Melvin},
    publisher = {Wiley},
    title = {{The wages of war, 1816-1965: a statistical handbook}},
    year = {1972}
    }
    
2.  Introduïm al **YAML**:

<!-- -->

    bibliography: biblio.bib

3. Citem al **text**.

-   Si l'envoltem de claudàtors `[@Singer1987]` ens posarà nom i any entre parèntesi: [@Singer1987].
-   Si no utilitzem els claudàtors `@Singer1987` ens posarà només l'any entre parèntesi: @Singer1987.

4.  En l'última línia del document de RMarkdown, posarem un títol `# Referències` per separar la bibliografia de la resta del text.




::: aside
Per saber-ne més sobre l'estil de citació BibTex, podeu consultar [RMarkdown Cookbook: Bibliographies and Citations](https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html), [Reproducible Research in R: Section 10 Citations](https://monashdatafluency.github.io/r-rep-res/citations.html) o [Wikibooks: LaTeX/Bibliography Management](https://en.wikibooks.org/wiki/LaTeX/Bibliography_Management#BibTeX).
:::



# RMarkdown avançat {background-color="#e8e8e8"}

## Taules

```{r echo = T, eval = F}
knitr::kable()
```


```{r echo = T, eval = F}
DT::data.table()
```



kable(df, - col.names = c("Noms", "Ben", "Posats) - align = c("ccc") - caption = "Títol"

Taules de tota mena amb [KableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)

## Figures


- `fig.width`: amplada en inches. 
- `fig.height`: alçada en inches. 
- `fig.align`: "left", "right", "center". 
- `fig.dim`: primer width i després height, c(5,3) 
- `out.width`: "50%" ocuparà el 50% de l'amplada del report


## Opcions globals

Opcions que son per tot el document: - posar un chunk amb include = FALSE - knitr::opts_chunk\$set(fig.align = "center", echo = TRUE)

knitr::opts_chunk\$set(comment = '', fig.width = 6, fig.height = 6)

És recomanable tenir un primer chunk amb el nom `setup` o similar on anotem algunes configuracions bàsiques del nostre RMarkdown. És molt útil utilitzar el següent codi per marcar les opcions per defecte de tots els chunks del document. A continuació indiquem que s'amagui el codi, els missatges i avisos de tots els chunks.

    knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

El primer chunk també pot ser útil per carregar els paquets i objectes que necessitarem durant el document.

## Què evitar als chunks

-   download.file
-   carregar bases de dades d'internet
-   funcions que carreguen bases de dades (ex. CEO)

## Dashboards

[flexdashboard](https://pkgs.rstudio.com/flexdashboard/)

## Canviar mida de text

```{r eval = F, echo = T}
    <style>
    body {
    font-size: 13pt;
    text-align: justify}
    </style>
```

## Taules {#rmd-taules}

Una altra de les assignatures pendents de RMarkdown són les taules. Imaginem-nos com creem una taula en Word: anem a "Crear taula" i simplement ens demanarà el nombre de files i columnes de la taula. En RMarkdown és molt més embolicat. Vegem un exemple. Aquest és el codi que haurem d'utilitzar per crear una taula.

```{r eval = F, echo = T}
    | Funció       | Paquet    | Descripció                                           |
    |--------------|-----------|------------------------------------------------------|
    | `filter()`   | `dplyr`   | Filtra les observacions d'un marc de dades           |
    | `separate()` | `tidyr`   | Separa els elements d'un vector en base a un criteri |
    | `read_csv()` | `readr`   | Llegeix els arxius CSV                               |
    | `ggplot()`   | `ggplot2` | Reprodueix elements gràfics                          |

```

    | Funció       | Paquet    | Descripció                                           |
    |--------------|-----------|------------------------------------------------------|
    | `filter()`   | `dplyr`   | Filtra les observacions d'un marc de dades           |
    | `separate()` | `tidyr`   | Separa els elements d'un vector en base a un criteri |
    | `read_csv()` | `readr`   | Llegeix els arxius CSV                               |
    | `ggplot()`   | `ggplot2` | Reprodueix elements gràfics                          |

Hi ha algunes opcions, més senzilles, per crear taules. La primera és construir-les a partir d'un marc de dades o una matriu de dades. La segona és utilitzar l'**Editor Visual** ([veure següent apartat](#rmd-visual-editor)).

### Editor visual {#rmd-visual-editor}

L'Editor Visual va sortir en una de les actualitzacions de RMarkdown del 2020 per donar resposta a usuaris que necessitaven una interfície més semblant a Word per generar documents. Per utilitzar l'Editor Visual, heu de clicar a la rodeta del document de RMarkdown i seleccionar la primera opció:

![](img/rmarkdown-visual-editor.png){width="40%"}

Amb l'editor visual veurem una interfície que ens serà molt més familiar. No obstant, recomanem utilitzar-lo només puntualment.

### Exportar i publicar {#rmd-rpubs}

Publicar un document generat amb RMarkdown a internet és molt ràpid. La forma més directa és mitjançant RPubs, encara que també es poden fer pàgines web més sofisticades, blocs o llibres.

-   [RPubs](https://rpubs.com/): RPubs és la manera més ràpida de publicar a la xarxa. A dins d'RStudio, un cop l'Html s'hagi generat en el Viewer, cliqueu a l'icona blava del Viewer (Publish -\> Publish a Document), seleccioneu RPubs i seguiu les instruccions.
-   [Bookdown](https://bookdown.org/): Permet crear llibres com el que esteu llegint.
-   [Blogdown](https://bookdown.org/yihui/blogdown/): Permet crear blocs, com per exemple: [www.jordimas.cat](www.jordimas.cat).

## Exportar

## El món de l'endemà

::: columns
::: {.column width="50%"}
[Quarto](www.quarto.org) ![](img/quarto.png)
:::

::: {.column width="50%"}
[Posit](www.posit.co) ![](img/posit.png)
:::
:::

# Referències

## Bibliografia principal

-   [Guia ràpida de RMarkdown a la web de RStudio.](https://rmarkdown.rstudio.com/lesson-1.html){target="_blank"}
-   [Cheatsheet RMarkdown.](https://www.rstudio.com/resources/cheatsheets/){target="_blank"}
-   [Capítol de RMarkdown al llibre *R para ciencia de datos*](https://es.r4ds.hadley.nz/r-markdown.html){target="_blank"} [@Grolemund2020].
-   [El llibre complet: *RMarkdown: The Definitive Guide*](https://bookdown.org/yihui/rmarkdown/html-document.html){target="_blank"} [@rmarkdown2018].

---
title: "Conjunts de dades"
subtitle: "Metodologia Quantitativa I (UPF)"
author: "Jordi Mas Elias"
institute: "<https://www.jordimas.cat/>"
footer: "Metodologia Quantitativa I (UPF)"
logo: logo-upf.png
bibliography: [references.bib, packages.bib]
format: 
  revealjs:
    embed-resources: true
    slide-number: true
    show-slide-number: print
    theme: simple
editor: source
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown', 'dplyr', 'ggplot2',
  'tidyr', 'readxl', 'readr', 'tidyverse', 'pacman', 'lubridate',
  'forcats', 'stringr'
), 'packages.bib')
```


## Sumari

-   Warm up
-   Què és un conjunt de dades?
-   Observacions
-   Variables


```{r echo = F, message=F, warning=F}
library(tidyverse)
library(readxl)
```


# Warm up {background-color="#e8e8e8"}

## Corba d'aprenentatge

```{r}
rlc <- tibble(class = 1:8,
             knowledge = (1:8)^3)
class <- 2
plot(rlc$class, rlc$knowledge)
points(rlc$class[2], rlc$knowledge[2], col = "red")
```



# Què és un conjunt de dades? {background-color="#e8e8e8"}

## Taula

Un nom genèric. Potser gairebé qualsevol cosa.

- Taula periòdica
- Taula de multiplicat
- Taula de la veritat
- Taula del Khi-quadrat 
- Taula fonètica
- ...

## Dades

- **Font d'informació (FI):** Material empíric cru.
- **Dades:** FI recollida, processada, sistematitzada i organitzada [@VanEvera2009].
    - Nombres, caràcters, símbols ... no tenen significat.
- **Base de dades:** Col·lecció organitzada de dades emmagatzemada i accessible electrònicament / Col·lecció organitzada de dades que emmagatzema múltiples conjunts de dades. 
- **Conjunt de dades:** Col·lecció estructura de dades, generalment associada a un únic cos de treball.


## Full de càlcul

Excel emmagatzema dades en dues dimensions:

![](img/excel-spreadsheet.png)


## Marc de dades / tibble

Una de les maneres^[N'hi ha d'altres: vector, matrix, array...] d'emmagatzemar dades a R en **dues dimensions**: files i columnes^[I normalment emmagatzemarem els marcs de dades a la manera *tidy*.]:

```{r echo = F}
read_xls("data/p5v2018.xls") |> 
  select(scode, country, year, polity2, xrreg:parreg)
```



## Tidy data

Considerem un marc de dades net (*tidy*) si compleix els següents requisits [@Wickham2014]:

- Cada marc de dades té una única **unitat d'observació**.
- **Observacions**: Es representen a les files.
- **Variables**: Es representen a les columnes.
- Cada **cel·la** indica un valor.

## RStudio workflow

**Load packages.**

```{r echo = T, message=F, warning=F}
library(dplyr)
library(readr)
library(stringr)
library(forcats)
```

![](img/r-packages.png){style="float:center;" width="650"}


# Observacions {background-color="#e8e8e8"}

## Observar ...

:::: {.columns}

::: {.column width="40%"}
Necessitem decidir quines són les **unitats** d'interès.
:::

::: {.column width="60%"}
![](https://2.bp.blogspot.com/-wA7H0iOgUgM/VtSymS91sfI/AAAAAAAAA1U/UEtXfoDg8j0/s1600/day_globe_75fr_125ms.gif)
:::

::::




## Què és una observació? {.scrollable}

-	**Unitat d'anàlisi:** Sobre què volem saber alguna cosa.
    - Determinada per la hipòtesi / pregunta.
-	**Unitat d'observació:** Què descriu cada fila del dataset.
    - Determinat per les dades.

[Ethnic Power Relations](https://icr.ethz.ch/data/epr/){target="_blank"}, International Conflict Research.

```{r}
read_csv("data/rfe.csv")
```




## Nivell d'anàlisi {.scrollable}

- **Nivell macro:** Estats, regions, sistemes legals.
- **Nivell meso:** Organitzacions, grups ètnics, partits polítics.
- **Nivell micro:** Famílies, individus, relacions de persones.
  - Events: Bombardejos, contractes, atacs terroristes.

```{r}
read_csv("data/cam_list_3.0.csv") |> 
  select(-date)
```

[Coup Agency and Mechanisms Dataset](https://militarycoups.org/Codebook-v3.0.html){target="_blank"}


## Fal·làcia ecològica

Quan la UA i la UO no concorden, tenim el risc d'incórrer en un problema de fal·làcia ecològica.

::: aside

- Admissions de Berkeley (veure [Simpson's paradox](https://en.wikipedia.org/wiki/Simpson%27s_paradox){target="_blank"}).

```{r}
uni <- tibble(faculty = rep(c("Psysics", "Politics", "Journalism"), times = 1, each = 2),
              sex = rep(c("Men", "Women"), times = 3),
              applicants = c(825,108,325,593,181,392),
              admitted = c(520, 76, 119, 203, 52, 115))
uni |> 
  group_by(sex) |> 
  summarize(applicants = sum(applicants),
            admitted = sum(admitted)) |> 
  mutate(perc_admissions = round(admitted / applicants * 100, 2)) |> 
  knitr::kable()
```

- Suicidi (crítica a Durkheim).

```{r}
suicide <- tibble(region = c("Isère"),
                  municipality = rep(c("Grenoble", "Le Bourg-d'Oisans", "Saint-Jean-de-Maurienne"), times = 1, each = 2),
                  religion = rep(c("Protestant", "Catholic"), times = 3),
                  population = c(8250,1080,325,593,181,392),
                  suicide = c(520, 72, 12, 20, 5, 11))
suicide |> 
  group_by(religion) |> 
  summarize(population = sum(population),
            suicide = sum(suicide)) |> 
  mutate(perc_suicide = round(suicide / population * 100, 2)) |> 
  knitr::kable()
```
:::

## Fal·làcia ecològica

Eleccions Barcelona 2019, nivell de districte.

![](img/bcn1.png)

## Fal·làcia ecològica

Eleccions Barcelona 2019, nivell de barri.

![](img/bcn2.png)

## Fal·làcia ecològica

Eleccions Barcelona 2019, nivell de secció censal.

![](img/bcn3.png)



# Variables {background-color="#e8e8e8"}

## Què és una variable?

La característica de l'objecte que estem estudiant.

- **Varia**: Prendrà diferents valors.

```{r echo = F}
suicide <- tibble(region = c("Isère"),
                  municipality = rep(c("Grenoble", "Le Bourg-d'Oisans", "Saint-Jean-de-Maurienne"), times = 1, each = 2),
                  religion = rep(c("Protestant", "Catholic"), times = 3),
                  population = c(8250,1080,325,593,181,392),
                  suicide = c(520, 72, 12, 20, 5, 11))
suicide

```



## Tipus de variables (1a): Nominal

Categories desordenades:

- **Municipi:** Barcelona, Sant Cugat, Ripoll...
- **Religió:** Muslim, Catholic, Shinto...
- **Idioma:** Russian, Catalan, Swedish.
- **Ideologia:** Conservatism, Nationalism, Liberal...
- **Partits polítics:** PSOE, PP, Cs, ERC...

També es diuen _strings_, [`stringr`](https://stringr.tidyverse.org/){target="_blank"} [@R-stringr] | [Cheatsheet](https://www.rstudio.com/resources/cheatsheets/){target="_blank"}.

## Tipus de variables (1b): Nominal

- **Emmagatzematge:** Character, factor

- **Operacions:**
  - Igualtat: `==`
  - Igualtat: `%in%`
  - No igualtat: `!=`


## Tipus de variables (2a): Ordinal

Categories desordenades:

- **Mida:** Small, Medium, Large.
- **Any:** Child, Young, Adult.
- **Educació:** Primary, Secondary, Tertiary.
- **Idees:** Disagree, Neutral, Agree.

Per factors, [`forcats`](https://forcats.tidyverse.org/){target="_blank"} [@R-forcats] | [Cheatsheet](https://www.rstudio.com/resources/cheatsheets/){target="_blank"}.

## Tipus de variables (2a): Ordinal {.scrollable}

- **Emmagatzematge:** Factor desordenat

- **Operacions:**
  - Igualtat: `==`
  - Igualtat: `%in%`
  - No igualtat: `!=`
  - Més que: `>`
  - Més o igual que: `>=`
  - Menys que: `<`
  - Menys o igual que: `<=`
  

## Tipus de variables (3a): Interval {.scrollable}

Nombres, el zero és arbitrari.

- **Any:** 2004, 2005, 2008, 2010.
- **Temperatura** (except Kelvin)**:** 10, 25, 30.
- **Ideologia:** Left-right measured as 0-10.
- **Coordenades:** Longitude and latitude.



## Tipus de variables (3b): Interval {.scrollable}

- **Emmagatzematge:** Numeric, integer, date

- **Operacions:**
  - Igualtat: `==`
  - Igualtat: `%in%`
  - No igualtat: `!=`
  - Més que: `>`
  - Més o igual que: `>=`
  - Menys que: `<`
  - Menys o igual que: `<=`
  - Suma i difèrencia: `+`, `-`
  - Max i min: `max()`, `min()`


## Tipus de variables (4a): Ratio {.scrollable}

Nombres, zero té significat

- **Any:** 2, 5, 7, 9.
- **Percentatges:** 0%, 34%, 100%.
- **Població:** 200, 3345000, 13000000.
- **Índexs** (not all of them)**:** 0.245, 0.999.


## Tipus de variables (4b): Ratio {.scrollable}

- **Emmagatzematge:** Numèric

- **Operacions:**
  - Igualtat: `==`
  - Igualtat: `%in%`
  - No igualtat: `!=`
  - Més que: `>`
  - Més o igual que: `>=`
  - Menys que: `<`
  - Menys o igual que: `<=`
  - Suma: `+`
  - Diferència: `-`
  - Multiplicació: `*`
  - Divisió: `/`
  - Altres: `sqrt()`, `log()`, `exp()`, `max()`, `min()`, `mean()`...



## Tipus de variables (5): Sumari

```{r echo = FALSE}
tribble(~Tipus, ~Característiques, ~Vector, ~Operacions, 
        "Categòrica nominal", "Categories no ordenables", "Caràcter o factor", "==, %in%, !=",
        "Categòrica ordinal", "Categories ordenables", "Factor", "==, %in%, !=, <=, <, >, >=",
        "Numèrica d'interval", "Nombres, zero sense significat", "Numèric o enter", "==, !=, <=, <, >, >=, +, -",
        "Numèrica de ràtio", "Nombres, zero amb significat", "Numèric", "==, !=, <=, <, >, >=, +, -, *, / ...") |> 
  knitr::kable()
```



# Bibliografia {background-color="#e8e8e8"}


---
title: "Data cleaning"
subtitle: "Quantitative Methodology (UPF)"
author: "Jordi Mas Elias"
institute: "<https://www.jordimas.cat/>"
footer: "Quantitative Methodology (UPF)"
logo: logo-upf.png
bibliography: references.bib
format: 
  revealjs:
    embed-resources: true
    slide-number: true
    show-slide-number: print
    theme: simple
editor: source
editor_options: 
  chunk_output_type: console
---

## Summary

-   Introduction
-   Tidy data
-   Missing data
-   Join data
-   Codebooks

```{r echo = F, message=F, warning=F}
library(tidyverse)
library(readxl)
```

# Warm up {background-color="#e8e8e8"}

## Warm up

```{r}
library(dplyr)
library(ggplot2)
rlc <- tibble(class = 1:8,
             knowledge = (1:8)^3)
lesson <- 8
rlc |> 
  ggplot(aes(x = class, y = knowledge)) +
  geom_line() +
  geom_point(data = rlc |> 
               filter(class == lesson), col = "red") +
  annotate("text", x = 4.5, y = 425, label = "You are here!") +
  geom_curve(aes(x = 5, xend = 7.8, y = 450, yend = 515),
             arrow = arrow(length = unit(0.08, "inch")), size = 0.5,
             color = "gray40", curvature = -0.3) +
  theme_minimal() +
  labs(x = "Class number", y = "Knowledge", title = "The R Knowledge curve")
```


## Warm up

Paint the fence, first...

![](img/paint_fence.jpeg)

## Warm up

...karate later.

![](img/karate-practice.gif)


## Warm up

Data wrangling

![](img/minority.gif)




## Warmp UUUUP


## Advanced

- Aesthetics in one geometry, but not in another.
- stat_summary
- geom_smooth
- Put the aesthetics in the geom function.
- [Datawrapper](https://xarxanet.org/informatic/recursos/com-fer-un-grafic-interactiu-amb-datawrapper)


MORE

recoding

is.na()


CORREU
Aquesta propera setmana...
acabarem ggplot2...
farem exercicis a l'aula de dplyr + ggplot2
demanaré deures per casa:
- almenys un dplyr
- ggplot2
- per correu, només resoldré dubtes de com obtenir dades. és a dir, si algú li interessa unes dades, té localitzat l'arxiu, però li està costant saber com entrar-les a R, l'ajudaré. Per la resta de coses, us espavileu.

Serà un bon moment per resoldre dubtes conjuntament



# Introduction {background-color="#e8e8e8"}

## Introduction

> "Data Scientists spend up to 80% of the time on data cleaning and 20% on actual data analysis".

![Source: R for Data Science](img/whole-game.png)


## Introduction {.scrollable}

A _df_ is *tidy* if it fulfills these requirements [@Wickham2014]:

![](img/wickham.jpeg){style="float:right;" width="300"}

::: columns
::: {.column width="65%"}

- Each _df_ has one **unit of observation**.
- **Observations** represented in the rows.
- **Variables** represented in the columns.
- Each **cell** indicates a value.
:::

::: {.column width="30%"}
:::

![Source: R for Data Science](img/tidydata.png)
:::

## Introduction

Why do we need to clean data? 

- Data is not tidy.
- Data is in many datasets.
- Data is missing.

## Introduction

**Load packages.**

```{r echo = T, message=F, warning=F}
library(dplyr)
library(readr)
library(tidyr)
library(countrycode)
```

![](img/r-packages.png){style="float:center;" width="650"}




# Tidy data {background-color="#e8e8e8"}



## Untidy dataframes? {.smaller}

Number of TB cases documented by the WHO in Afghanistan, Brazil, and China between 1999 and 2000 (cases & population).

:::: {.columns}

::: {.column width="50%"}
Table A
```{r}
table3
```

Table B
```{r}
table1
```
:::

::: {.column width="50%"}
Table C

```{r}
table2
```

Table D
```{r}
table4a
```
:::
::::



## A tidy dataframe

NOO ANOTHER

Correlates of War [Intra-State War Data](https://correlatesofwar.org/data-sets/cow-war/)

```{r}
interstate <- read_csv("data/Intra-StateWarData_v4.1.csv")
interstate |> 
  select(WarName, WarType, SideA, SideB)
```

## An untidy dataframe

PEW Research [Religious Landscape Study](https://www.pewresearch.org/religion/religious-landscape-study/)^[More datasets available in the `tidyr::` package.]

```{r}
tidyr::relig_income |> 
  select(1:6)
```



## Pivoting data

We change the rows and columns of the dataframe keeping the same information.

- Pivot longer
```
pivot_longer(df, cols, names_to, names_to)
```

- Pivot wider
```
pivot_wider(df, names_from, values_from)
```

- Separate

```
separate(df, col, into, sep)
```

- Unite

```
unite(df, col, ..., sep)
```


#  Join data {background-color="#e8e8e8"}

## Join data

## Classifications

- States: [Countrycode](https://www.rdocumentation.org/packages/countrycode/versions/1.4.0/topics/countrycode), [ISO 3166-1](https://www.iso.org/iso-3166-country-codes.html), [Eurostat](https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Glossary:Country_codes).
- Regions: [UN](https://population.un.org/wpp/DefinitionOfRegions/).
- Intergovernmental Organizations: [COW](https://correlatesofwar.org/data-sets/igos/)
- Political parties: [Party facts](https://partyfacts.herokuapp.com).
- Regions: 3166-2.
- Municipalities: [IDESCAT](https://www.idescat.cat/codis/?id=50&n=9), [INE](https://www.ine.es/daco/daco42/codmun/codmunmapa.htm).
- Census sections: [IDESCAT](https://www.idescat.cat/codis/?id=50&n=81).







#  Missing data {background-color="#e8e8e8"}


## Why they are missing?

NA (Not Available)

Related with the state capacity to collect them [@Stone2008]

Check the World Bank

Small or underdeveloped states






#  Codebooks {background-color="#e8e8e8"}



##  Bibliography {background-color="#e8e8e8"}
